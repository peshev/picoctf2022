import re

import psycopg2

psql_command = "psql -h saturn.picoctf.net -p 49899 -U postgres pico"
password = "postgres"

psql_command = psql_command.split()
psql_parameters = {psql_command[i]: psql_command[i + 1] for i in range(1, len(psql_command) - 1, 2)}
dbname = psql_command[-1]
with psycopg2.connect(f"dbname={dbname} "
                      f"host={psql_parameters['-h']} "
                      f"port={psql_parameters['-p']} "
                      f"user={psql_parameters['-U']} "
                      f"password={password}") as conn:
    with conn.cursor() as cur:
        cur.execute("select tablename from pg_catalog.pg_tables where schemaname='public';")
        for (table_name,) in cur.fetchall():
            cur.execute(f"select * from {table_name};")
            for row in cur.fetchall():
                for c in row:
                    if isinstance(c, str) and re.match(r"picoCTF\{.+}", c):
                        flag = c

print(flag)
